# Export Feature Testing Guide

## Overview
This guide provides step-by-step instructions for testing the export functionality across all report pages in the LMS web application.

## Prerequisites
1. Ensure the application is running (`npm run dev` or `npm run dev:development`)
2. Have access to accounts with different roles:
   - **Teacher** account (for Teacher Reports)
   - **Admin/Super User** account (for Admin Reports and AI Reports)
3. Ensure there is some data in the system (students, courses, assignments, etc.)

---

## Testing Locations

### 1. Teacher Reports (`/dashboard/reports`)
**Access:** Teacher role required

### 2. Admin Reports Overview (`/dashboard/reports`)
**Access:** Admin, Super User, or Content Creator role required

### 3. AI Performance Analytics (`/dashboard/reports`)
**Access:** Admin or Super User role required

---

## Step-by-Step Testing Instructions

### Test Case 1: Teacher Reports Export

#### Steps:
1. **Login as a Teacher**
   - Navigate to the login page
   - Login with teacher credentials

2. **Navigate to Reports**
   - Go to `/dashboard/reports` or click "Performance Analytics" in the sidebar
   - Wait for the reports to load

3. **Test PDF Export**
   - Click the "Export" button in the top-right corner
   - Select "PDF Document" from the dropdown
   - **Expected Result:**
     - Toast notification: "Exporting as PDF Document..."
     - After completion: "Export completed successfully!"
     - PDF file downloads with name: `teacher-performance-analytics_YYYY-MM-DD_HH-MM-SS.pdf`
     - **Verify PDF contains:**
       - Report title: "Teacher Performance Analytics Report"
       - Generated date and time
       - Generated by (your email)
       - Executive summary
       - Key metrics section
       - Student Progress table
       - Course Performance table
       - Assignment Performance table
       - Monthly Trends table
       - Page numbers in footer

4. **Test Excel Export**
   - Click "Export" button again
   - Select "Excel Workbook" from the dropdown
   - **Expected Result:**
     - Toast notification appears
     - Excel file downloads: `teacher-performance-analytics_YYYY-MM-DD_HH-MM-SS.xlsx`
     - **Verify Excel file contains:**
       - "Report Info" sheet with metadata
       - "Summary" sheet (if summary exists)
       - "Key Metrics" sheet
       - "Student Progress" sheet with all columns
       - "Course Performance" sheet
       - "Assignment Performance" sheet
       - "Monthly Trends" sheet
     - Open in Excel/LibreOffice and verify:
       - Column widths are appropriate
       - Data is properly formatted
       - Percentages show correctly

5. **Test CSV Export**
   - Click "Export" button
   - Select "CSV File" from the dropdown
   - **Expected Result:**
     - CSV file downloads: `teacher-performance-analytics_YYYY-MM-DD_HH-MM-SS.csv`
     - **Verify CSV file:**
       - Opens correctly in Excel/Google Sheets
       - Contains headers in first row
       - Data rows are properly formatted
       - Special characters are escaped correctly
       - Can be imported into other systems

#### Test Edge Cases:
- **Empty Data:** If no students/courses exist, verify export still works (shows "No data available")
- **Large Dataset:** Test with many students (100+) to verify performance
- **Special Characters:** Verify names/emails with special characters export correctly

---

### Test Case 2: Admin Reports Overview Export

#### Steps:
1. **Login as Admin/Super User**
   - Navigate to login page
   - Login with admin credentials

2. **Navigate to Reports Overview**
   - Go to `/dashboard/reports` (Admin Reports Overview)
   - Wait for data to load

3. **Test with Different Time Ranges**
   - Change time range filter (Today, This Week, This Month, All Time)
   - Click Export → PDF
   - **Verify:** Time range is included in the exported file metadata

4. **Test All Export Formats**
   - Export as PDF, Excel, and CSV
   - **Verify each contains:**
     - User Growth Trends table
     - Platform Statistics table
     - Course Analytics table
     - Course Performance table
     - Engagement Data table
     - User Analytics table
     - Engagement Metrics table
     - All key metrics (Total Users, Teachers, Students, etc.)

5. **Verify Data Accuracy**
   - Compare exported data with on-screen data
   - Ensure numbers match exactly
   - Verify percentages are calculated correctly

---

### Test Case 3: AI Performance Analytics Export

#### Steps:
1. **Navigate to AI Reports**
   - As Admin/Super User, go to `/dashboard/reports` (AI Analytics view)
   - Or toggle to AI mode if available

2. **Test Export with Different Time Ranges**
   - Change time range (Today, This Week, This Month, All Time)
   - Export as PDF
   - **Verify:** Time range appears in metadata

3. **Verify Export Contents**
   - **PDF should contain:**
     - Practice Stage Performance table
     - User Engagement table
     - Time Usage Patterns table
     - Top Content Accessed table
     - Analytics overview metrics
     - Key metrics (Total Users, Active Today, Students, Teachers)

4. **Test Excel Export**
   - Export as Excel
   - **Verify:**
     - Multiple sheets are created
     - Each table is in its own sheet
     - Column widths are appropriate
     - Data formatting is correct

---

## Functional Testing Checklist

### ✅ Export Button Visibility
- [ ] Export button appears in the header of all report pages
- [ ] Button is visible when data is loaded
- [ ] Button is disabled during loading states
- [ ] Button shows loading spinner during export

### ✅ Export Dropdown Menu
- [ ] Dropdown opens when clicking Export button
- [ ] All three formats are available (PDF, Excel, CSV)
- [ ] Format descriptions are clear
- [ ] Icons are displayed correctly
- [ ] Menu closes after selection

### ✅ Toast Notifications
- [ ] Loading toast appears when export starts
- [ ] Success toast appears when export completes
- [ ] Error toast appears if export fails
- [ ] Toast messages are clear and informative

### ✅ File Downloads
- [ ] Files download with correct names
- [ ] Filenames include timestamp
- [ ] File extensions are correct (.pdf, .xlsx, .csv)
- [ ] Files are not corrupted
- [ ] Files can be opened in appropriate applications

### ✅ PDF Export Quality
- [ ] PDF is properly formatted
- [ ] Headers and footers are present
- [ ] Page breaks work correctly
- [ ] Tables fit on pages
- [ ] Text is readable
- [ ] Metadata is included
- [ ] Summary section is present

### ✅ Excel Export Quality
- [ ] Multiple sheets are created correctly
- [ ] Column widths are appropriate
- [ ] Headers are in first row
- [ ] Data formatting is correct
- [ ] Percentages display correctly
- [ ] Dates are formatted properly
- [ ] Can be opened in Excel/LibreOffice

### ✅ CSV Export Quality
- [ ] Headers are in first row
- [ ] Data rows are properly formatted
- [ ] Commas in data are escaped
- [ ] Quotes are handled correctly
- [ ] Can be imported into Excel/Google Sheets
- [ ] Can be imported into other systems

### ✅ Data Accuracy
- [ ] Exported data matches on-screen data
- [ ] Numbers are correct
- [ ] Percentages are calculated correctly
- [ ] Dates are formatted correctly
- [ ] No data is missing
- [ ] No duplicate data

### ✅ Error Handling
- [ ] Error message appears if export fails
- [ ] Application doesn't crash on error
- [ ] User can retry after error
- [ ] Error messages are user-friendly

### ✅ Performance
- [ ] Export completes within reasonable time (< 10 seconds for normal datasets)
- [ ] UI remains responsive during export
- [ ] Large datasets (1000+ rows) export successfully
- [ ] Memory usage is reasonable

---

## Browser Testing

Test the export feature in different browsers:
- [ ] **Chrome/Edge** (Chromium)
- [ ] **Firefox**
- [ ] **Safari** (if on Mac)
- [ ] **Mobile browsers** (if applicable)

---

## Role-Based Testing

### Teacher Role
- [ ] Can export Teacher Reports
- [ ] Cannot access Admin Reports export
- [ ] Cannot access AI Reports export

### Admin/Super User Role
- [ ] Can export all report types
- [ ] All export formats work
- [ ] Time range filters work in exports

### Content Creator Role
- [ ] Verify export permissions (if applicable)

---

## Data Validation Tests

### Test with Various Data Scenarios:

1. **Empty Data**
   - Reports with no students
   - Reports with no courses
   - Reports with no assignments
   - **Verify:** Export still works, shows "No data available" appropriately

2. **Minimal Data**
   - 1 student
   - 1 course
   - 1 assignment
   - **Verify:** Export works correctly with minimal data

3. **Large Dataset**
   - 100+ students
   - 50+ courses
   - 200+ assignments
   - **Verify:** Export completes successfully, all data is included

4. **Special Characters**
   - Student names with special characters (é, ñ, ü, etc.)
   - Course titles with quotes, commas
   - Email addresses
   - **Verify:** Special characters are handled correctly in all formats

5. **Edge Cases**
   - Very long course titles
   - Very long student names
   - Zero percentages
   - 100% completion rates
   - Negative numbers (if applicable)
   - **Verify:** All edge cases are handled gracefully

---

## Regression Testing

After making changes, verify:
- [ ] Existing export functionality still works
- [ ] No console errors appear
- [ ] No TypeScript errors
- [ ] All report pages still load correctly
- [ ] Export button appears on all pages
- [ ] Previous exports still work

---

## Performance Benchmarks

Expected performance:
- **Small dataset (< 100 rows):** < 2 seconds
- **Medium dataset (100-1000 rows):** < 5 seconds
- **Large dataset (1000+ rows):** < 10 seconds

If exports take longer, investigate:
- Network speed
- Browser performance
- Data processing time
- File generation time

---

## Troubleshooting

### Issue: Export button doesn't appear
**Solution:**
- Check if user has proper role/permissions
- Verify data is loaded
- Check browser console for errors
- Verify component is properly imported

### Issue: Export fails with error
**Solution:**
- Check browser console for detailed error
- Verify all required dependencies are installed
- Check if data structure matches expected format
- Verify file permissions

### Issue: Exported file is corrupted
**Solution:**
- Try different browser
- Clear browser cache
- Check if file size is reasonable
- Verify export service is working correctly

### Issue: Data doesn't match on-screen
**Solution:**
- Verify data preparation function
- Check if filters are applied correctly
- Ensure data transformation is correct
- Compare raw data with exported data

---

## Automated Testing (Future Enhancement)

Consider adding automated tests for:
- Export button rendering
- Export function calls
- File download triggers
- Data transformation accuracy
- Error handling

---

## Test Report Template

When testing, document:

```
Test Date: [Date]
Tester: [Name]
Browser: [Browser and Version]
Role: [Teacher/Admin/Super User]

Report Page: [Which report]
Export Format: [PDF/Excel/CSV]
Time Range: [If applicable]

Result: [Pass/Fail]
Issues Found: [List any issues]
Screenshots: [Attach if issues found]
```

---

## Quick Test Script

For quick verification, run through this checklist:

1. ✅ Login as Teacher → Go to Reports → Export PDF → Verify download
2. ✅ Login as Admin → Go to Reports → Export Excel → Verify multiple sheets
3. ✅ Change time range → Export CSV → Verify time range in filename
4. ✅ Export with empty data → Verify graceful handling
5. ✅ Export large dataset → Verify performance
6. ✅ Test all three formats on each report page
7. ✅ Verify data accuracy by comparing on-screen vs exported
8. ✅ Test error handling (disconnect network, then try export)

---

## Success Criteria

The export feature is considered successful if:
- ✅ All export formats work on all report pages
- ✅ Files download correctly with proper names
- ✅ Exported data matches on-screen data
- ✅ All formats can be opened in appropriate applications
- ✅ Performance is acceptable (< 10 seconds for large datasets)
- ✅ Error handling is graceful
- ✅ User experience is smooth with proper feedback

---

## Notes

- PDF exports use jsPDF library
- Excel exports use xlsx library
- CSV exports use native browser Blob API
- All exports are client-side (no server calls needed)
- Files are generated in the browser and downloaded directly

---

## Support

If you encounter issues during testing:
1. Check browser console for errors
2. Verify all dependencies are installed (`npm install`)
3. Check network tab for any failed requests
4. Review the implementation files:
   - `universalExportService.ts`
   - `ExportButton.tsx`
   - Report page components

